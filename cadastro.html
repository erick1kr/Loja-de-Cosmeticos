<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Loja de Cosméticos - Cadastro</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h1>Página de Cadastro</h1>
      <form id="cadastroForm">
        <div class="mb-3">
          <label for="exampleInputName" class="form-label">Nome</label>
          <input type="text" class="form-control" id="exampleInputName" />
        </div>
        <div class="mb-3">
          <label for="exampleInputEmail2" class="form-label"
            >Endereço de e-mail</label
          >
          <input
            type="email"
            class="form-control"
            id="exampleInputEmail2"
            aria-describedby="emailHelp"
          />
        </div>
        <div class="mb-3">
          <label for="exampleInputPassword2" class="form-label">Senha</label>
          <input
            type="password"
            class="form-control"
            id="exampleInputPassword2"
          />
        </div>
        <button type="submit" class="btn btn-primary">Cadastrar</button>
      </form>
      <p class="mt-3">Já tem uma conta? <a href="login.html">Faça login</a></p>
    </div>
    <script>
      const express = require("express");
      const bodyParser = require("body-parser");
      const bcrypt = require("bcrypt");
      const { User } = require("./models"); // Supondo que você tenha um modelo User definido em './models'

      const app = express();
      const port = 3000;

      app.use(bodyParser.json());

      // Rota para lidar com o cadastro de usuários
      app.post("/backend/cadastro", async (req, res) => {
        const { nome, email, senha } = req.body;

        // Validação de dados (exemplo: verificar se todos os campos estão presentes)
        if (!nome || !email || !senha) {
          return res.status(400).send("Todos os campos são obrigatórios.");
        }

        // Verificar se o usuário já existe no banco de dados
        const existingUser = await User.findOne({ where: { email } });
        if (existingUser) {
          return res.status(400).send("Este e-mail já está sendo utilizado.");
        }

        try {
          // Hashing de senha
          const hashedPassword = await bcrypt.hash(senha, 10);

          // Criação do usuário no banco de dados
          await User.create({ nome, email, senha: hashedPassword });

          res.status(201).send("Usuário cadastrado com sucesso!");
        } catch (error) {
          console.error("Erro ao cadastrar usuário:", error);
          res
            .status(500)
            .send(
              "Ocorreu um erro ao cadastrar o usuário. Por favor, tente novamente mais tarde."
            );
        }
      });

      app.listen(port, () => {
        console.log(`Servidor está rodando em http://localhost:${port}`);
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
